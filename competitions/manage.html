<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary Meta Tags -->
    <title>Manage Competition | Uber Padel</title>
    <meta name="description" content="Manage your padel competition on Uber Padel.">
    <meta name="robots" content="noindex, nofollow">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../favicon.ico">
    <link rel="icon" type="image/svg+xml" href="../uberpadel-icon.svg">
    <link rel="apple-touch-icon" href="../uberpadel-icon-512.png">
    
    <!-- Theme -->
    <meta name="theme-color" content="#2563EB">
    
    <!-- Preconnect hints -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        * { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        body { font-family: 'Space Grotesk', -apple-system, BlinkMacSystemFont, sans-serif; }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up { animation: fadeInUp 0.5s ease-out forwards; }
        
        .tab-btn {
            transition: all 0.2s ease;
        }
        .tab-btn.active {
            color: #2563eb;
            border-bottom-color: #2563eb;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 min-h-screen">
    
    <!-- Navigation -->
    <nav class="bg-white/80 backdrop-blur-md border-b border-gray-100 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <a href="../index.html" class="flex items-center gap-3">
                    <img src="../uberpadel-icon.svg" alt="Uber Padel" class="w-10 h-10">
                    <span class="font-bold text-xl text-gray-800">Uber Padel</span>
                </a>
                <div class="flex items-center gap-4">
                    <a href="browse.html" class="text-gray-600 hover:text-blue-600 font-medium transition-colors">Browse</a>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="max-w-4xl mx-auto px-4 py-8">
        
        <!-- Loading State -->
        <div id="loading-state" class="text-center py-20">
            <div class="w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-gray-500">Loading...</p>
        </div>
        
        <!-- Access Denied -->
        <div id="access-denied" class="hidden text-center py-20">
            <div class="text-6xl mb-4">üîí</div>
            <h1 class="text-2xl font-bold text-gray-800 mb-2">Access Denied</h1>
            <p class="text-gray-600 mb-6">You don't have permission to manage this competition.</p>
            <a href="browse.html" class="inline-block px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-semibold transition-colors">
                Browse Competitions
            </a>
        </div>
        
        <!-- Organizer Key Entry -->
        <div id="key-entry" class="hidden">
            <div class="bg-white rounded-3xl shadow-xl p-8 max-w-md mx-auto animate-fade-in-up">
                <div class="text-center mb-6">
                    <div class="text-4xl mb-3">üîë</div>
                    <h1 class="text-2xl font-bold text-gray-800 mb-2">Organizer Access</h1>
                    <p class="text-gray-600">Enter your organizer key to manage this competition</p>
                </div>
                
                <form id="key-form" class="space-y-4">
                    <input type="text" id="organiser-key-input" required maxlength="6"
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none text-center text-2xl font-mono tracking-widest uppercase"
                        placeholder="------" />
                    <button type="submit"
                        class="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-semibold transition-colors">
                        Access
                    </button>
                </form>
            </div>
        </div>
        
        <!-- Management Content -->
        <div id="management-content" class="hidden">
            
            <!-- Header -->
            <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
                <div>
                    <a href="#" id="back-link" class="text-gray-500 hover:text-gray-700 text-sm">‚Üê Back to competition</a>
                    <h1 id="comp-name" class="text-2xl font-bold text-gray-800 mt-1"></h1>
                </div>
                <span id="status-badge" class="px-3 py-1 rounded-lg text-sm font-medium"></span>
            </div>
            
            <!-- Tabs -->
            <div class="bg-white rounded-t-3xl shadow-xl border-b border-gray-100">
                <div class="flex">
                    <button onclick="showTab('overview')" class="tab-btn active flex-1 py-4 text-center font-semibold border-b-2 border-transparent" data-tab="overview">
                        Overview
                    </button>
                    <button onclick="showTab('players')" class="tab-btn flex-1 py-4 text-center font-semibold text-gray-400 border-b-2 border-transparent" data-tab="players">
                        Players
                    </button>
                    <button onclick="showTab('settings')" class="tab-btn flex-1 py-4 text-center font-semibold text-gray-400 border-b-2 border-transparent" data-tab="settings">
                        Settings
                    </button>
                </div>
            </div>
            
            <!-- Tab Content -->
            <div class="bg-white rounded-b-3xl shadow-xl p-8">
                
                <!-- Overview Tab -->
                <div id="tab-overview" class="tab-content">
                    <!-- Status Actions -->
                    <div class="mb-8">
                        <h2 class="text-lg font-bold text-gray-800 mb-4">Status & Actions</h2>
                        
                        <div id="status-actions" class="grid md:grid-cols-2 gap-4">
                            <!-- Draft state -->
                            <div id="action-open-reg" class="hidden p-4 border-2 border-green-200 bg-green-50 rounded-xl">
                                <h3 class="font-semibold text-green-800 mb-2">Open Registration</h3>
                                <p class="text-sm text-green-700 mb-3">Allow players to register for your competition</p>
                                <button onclick="openRegistration()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors">
                                    Open Registration
                                </button>
                            </div>
                            
                            <!-- Registration state -->
                            <div id="action-start" class="hidden p-4 border-2 border-blue-200 bg-blue-50 rounded-xl">
                                <h3 class="font-semibold text-blue-800 mb-2">Start Competition</h3>
                                <p class="text-sm text-blue-700 mb-3">Close registration and begin matches</p>
                                <button onclick="startCompetition()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors">
                                    Start Now
                                </button>
                            </div>
                            
                            <!-- Active state -->
                            <div id="action-complete" class="hidden p-4 border-2 border-purple-200 bg-purple-50 rounded-xl">
                                <h3 class="font-semibold text-purple-800 mb-2">Complete Competition</h3>
                                <p class="text-sm text-purple-700 mb-3">Mark the competition as finished</p>
                                <button onclick="completeCompetition()" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium transition-colors">
                                    Mark Complete
                                </button>
                            </div>
                            
                            <!-- Cancel action -->
                            <div id="action-cancel" class="p-4 border-2 border-gray-200 bg-gray-50 rounded-xl">
                                <h3 class="font-semibold text-gray-800 mb-2">Cancel Competition</h3>
                                <p class="text-sm text-gray-600 mb-3">Cancel and notify all registered players</p>
                                <button onclick="cancelCompetition()" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors">
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Stats -->
                    <div class="grid md:grid-cols-3 gap-4">
                        <div class="bg-gray-50 rounded-xl p-4 text-center">
                            <div id="stat-players" class="text-3xl font-bold text-blue-600">0</div>
                            <div class="text-sm text-gray-600">Players Registered</div>
                        </div>
                        <div class="bg-gray-50 rounded-xl p-4 text-center">
                            <div id="stat-capacity" class="text-3xl font-bold text-green-600">0%</div>
                            <div class="text-sm text-gray-600">Capacity</div>
                        </div>
                        <div class="bg-gray-50 rounded-xl p-4 text-center">
                            <div id="stat-days" class="text-3xl font-bold text-purple-600">-</div>
                            <div class="text-sm text-gray-600">Days Until Event</div>
                        </div>
                    </div>
                    
                    <!-- Share Link -->
                    <div class="mt-8 p-4 bg-blue-50 rounded-xl">
                        <h3 class="font-semibold text-blue-800 mb-2">Share Competition</h3>
                        <div class="flex gap-2">
                            <input type="text" id="share-link" readonly
                                class="flex-1 px-4 py-2 bg-white border border-blue-200 rounded-lg text-sm" />
                            <button onclick="copyShareLink()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors">
                                Copy
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Players Tab -->
                <div id="tab-players" class="tab-content hidden">
                    <h2 class="text-lg font-bold text-gray-800 mb-4">
                        Registered Players (<span id="player-count">0</span>/<span id="max-players">0</span>)
                    </h2>
                    
                    <div id="players-list" class="space-y-2">
                        <!-- Populated by JS -->
                    </div>
                    
                    <div id="no-players" class="hidden text-center py-12 text-gray-500">
                        No players registered yet
                    </div>
                    
                    <!-- Add Player (manual) -->
                    <div class="mt-6 pt-6 border-t border-gray-100">
                        <h3 class="font-semibold text-gray-800 mb-3">Add Player Manually</h3>
                        <form id="add-player-form" class="flex gap-2">
                            <input type="text" id="add-player-name" required placeholder="Player name"
                                class="flex-1 px-4 py-2 border border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none" />
                            <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors">
                                Add
                            </button>
                        </form>
                    </div>
                </div>
                
                <!-- Settings Tab -->
                <div id="tab-settings" class="tab-content hidden">
                    <form id="settings-form" class="space-y-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Competition Name</label>
                            <input type="text" id="edit-name" required maxlength="60"
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none" />
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Description</label>
                            <textarea id="edit-description" rows="3" maxlength="500"
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none resize-none"></textarea>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Date</label>
                                <input type="date" id="edit-date"
                                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none" />
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Time</label>
                                <input type="time" id="edit-time"
                                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none" />
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Location</label>
                            <input type="text" id="edit-location" maxlength="100"
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none" />
                        </div>
                        
                        <button type="submit" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-semibold transition-colors">
                            Save Changes
                        </button>
                    </form>
                    
                    <!-- Danger Zone -->
                    <div class="mt-8 pt-8 border-t border-gray-200">
                        <h3 class="font-bold text-red-600 mb-4">Danger Zone</h3>
                        <button onclick="deleteCompetition()" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors">
                            Delete Competition
                        </button>
                    </div>
                </div>
                
            </div>
        </div>
        
    </main>
    
    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 flex flex-col gap-2"></div>
    
    <!-- Services -->
    <script src="../account/auth-service.js"></script>
    
    <!-- Shared Engines (Phase 3) -->
    <script src="../src/engines/BaseEngine.js"></script>
    <script src="../src/engines/AmericanoEngine.js"></script>
    <script src="../src/engines/MexicanoEngine.js"></script>
    <script src="../src/engines/TournamentEngine.js"></script>
    <script src="../src/engines/TeamLeagueEngine.js"></script>
    
    <!-- Competition Service (Phase 5) -->
    <script src="competition-service.js"></script>
    
    <script>
        // ===== STATE =====
        let currentUser = null;
        let competition = null;
        let competitionId = null;
        let hasAccess = false;
        
        // ===== INITIALIZATION =====
        
        async function init() {
            const params = new URLSearchParams(window.location.search);
            competitionId = params.get('id');
            
            if (!competitionId) {
                showAccessDenied();
                return;
            }
            
            await AuthService.init();
            CompetitionService.init();
            
            currentUser = AuthService.getCurrentUser();
            
            // Load competition
            competition = await CompetitionService.getById(competitionId);
            
            if (!competition) {
                showAccessDenied();
                return;
            }
            
            document.getElementById('loading-state').classList.add('hidden');
            
            // Check if user is organizer
            if (currentUser && competition.meta.organizerId === currentUser.id) {
                hasAccess = true;
                showManagement();
            } else {
                // Check for stored key
                const storedKey = sessionStorage.getItem(`organiser_key_${competitionId}`);
                if (storedKey && await CompetitionService.verifyOrganiserKey(competitionId, storedKey)) {
                    hasAccess = true;
                    showManagement();
                } else {
                    showKeyEntry();
                }
            }
        }
        
        function showAccessDenied() {
            document.getElementById('loading-state').classList.add('hidden');
            document.getElementById('access-denied').classList.remove('hidden');
        }
        
        function showKeyEntry() {
            document.getElementById('key-entry').classList.remove('hidden');
        }
        
        function showManagement() {
            document.getElementById('key-entry').classList.add('hidden');
            document.getElementById('management-content').classList.remove('hidden');
            renderManagement();
        }
        
        // ===== KEY VERIFICATION =====
        
        document.getElementById('key-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const key = document.getElementById('organiser-key-input').value.toUpperCase();
            
            if (await CompetitionService.verifyOrganiserKey(competitionId, key)) {
                sessionStorage.setItem(`organiser_key_${competitionId}`, key);
                hasAccess = true;
                showManagement();
            } else {
                showToast('Invalid organizer key', 'error');
            }
        });
        
        // ===== TABS =====
        
        function showTab(tabName) {
            // Update buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active', 'text-blue-600', 'border-blue-600');
                btn.classList.add('text-gray-400');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active', 'text-blue-600', 'border-blue-600');
            document.querySelector(`[data-tab="${tabName}"]`).classList.remove('text-gray-400');
            
            // Update content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`tab-${tabName}`).classList.remove('hidden');
        }
        
        // ===== RENDERING =====
        
        function renderManagement() {
            const meta = competition.meta;
            const statusInfo = CompetitionService.getStatusInfo(meta.status);
            
            // Header
            document.getElementById('comp-name').textContent = meta.name;
            document.getElementById('back-link').href = `view.html?id=${competitionId}`;
            
            document.getElementById('status-badge').className = `px-3 py-1 rounded-lg text-sm font-medium ${statusInfo.bgClass}`;
            document.getElementById('status-badge').textContent = statusInfo.label;
            
            // Stats
            const registeredCount = Object.keys(competition.registeredPlayers || {}).length;
            document.getElementById('stat-players').textContent = registeredCount;
            document.getElementById('stat-capacity').textContent = `${Math.round(registeredCount / meta.maxPlayers * 100)}%`;
            
            if (meta.eventDate) {
                const eventDate = new Date(meta.eventDate);
                const today = new Date();
                const diffDays = Math.ceil((eventDate - today) / (1000 * 60 * 60 * 24));
                document.getElementById('stat-days').textContent = diffDays >= 0 ? diffDays : 'Past';
            }
            
            // Status actions
            document.getElementById('action-open-reg').classList.toggle('hidden', meta.status !== 'draft');
            document.getElementById('action-start').classList.toggle('hidden', meta.status !== 'registration');
            document.getElementById('action-complete').classList.toggle('hidden', meta.status !== 'active');
            document.getElementById('action-cancel').classList.toggle('hidden', meta.status === 'completed' || meta.status === 'cancelled');
            
            // Share link
            document.getElementById('share-link').value = `${window.location.origin}/competitions/view.html?id=${competitionId}`;
            
            // Players
            renderPlayers();
            
            // Settings
            document.getElementById('edit-name').value = meta.name || '';
            document.getElementById('edit-description').value = meta.description || '';
            document.getElementById('edit-date').value = meta.eventDate || '';
            document.getElementById('edit-time').value = meta.eventTime || '';
            document.getElementById('edit-location').value = meta.location || '';
        }
        
        function renderPlayers() {
            const players = Object.values(competition.registeredPlayers || {});
            const list = document.getElementById('players-list');
            const noPlayers = document.getElementById('no-players');
            
            document.getElementById('player-count').textContent = players.length;
            document.getElementById('max-players').textContent = competition.meta.maxPlayers;
            
            if (players.length === 0) {
                list.classList.add('hidden');
                noPlayers.classList.remove('hidden');
                return;
            }
            
            noPlayers.classList.add('hidden');
            list.classList.remove('hidden');
            
            players.sort((a, b) => new Date(a.registeredAt) - new Date(b.registeredAt));
            
            list.innerHTML = players.map((p, i) => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl">
                    <div class="flex items-center gap-3">
                        <span class="w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold">
                            ${i + 1}
                        </span>
                        <div>
                            <div class="font-medium text-gray-800">${escapeHtml(p.name)}</div>
                            ${p.level ? `<div class="text-xs text-gray-500">Level: ${CompetitionService.formatLevel(p.level)}</div>` : ''}
                        </div>
                    </div>
                    <button onclick="removePlayer('${p.id}')" class="text-red-500 hover:text-red-700 text-sm font-medium">
                        Remove
                    </button>
                </div>
            `).join('');
        }
        
        // ===== ACTIONS =====
        
        async function openRegistration() {
            try {
                await CompetitionService.openRegistration(competitionId);
                competition = await CompetitionService.getById(competitionId);
                renderManagement();
                showToast('Registration opened!', 'success');
            } catch (error) {
                showToast('Failed to open registration', 'error');
            }
        }
        
        async function startCompetition() {
            const count = Object.keys(competition.registeredPlayers || {}).length;
            if (count < competition.meta.minPlayers) {
                showToast(`Need at least ${competition.meta.minPlayers} players`, 'error');
                return;
            }
            
            if (!confirm('Start the competition? Registration will close.')) return;
            
            try {
                await CompetitionService.start(competitionId);
                competition = await CompetitionService.getById(competitionId);
                renderManagement();
                showToast('Competition started!', 'success');
            } catch (error) {
                showToast('Failed to start competition', 'error');
            }
        }
        
        async function completeCompetition() {
            if (!confirm('Mark this competition as complete?')) return;
            
            try {
                await CompetitionService.complete(competitionId);
                competition = await CompetitionService.getById(competitionId);
                renderManagement();
                showToast('Competition completed!', 'success');
            } catch (error) {
                showToast('Failed to complete competition', 'error');
            }
        }
        
        async function cancelCompetition() {
            if (!confirm('Are you sure you want to cancel this competition? This cannot be undone.')) return;
            
            try {
                await CompetitionService.cancel(competitionId);
                competition = await CompetitionService.getById(competitionId);
                renderManagement();
                showToast('Competition cancelled', 'success');
            } catch (error) {
                showToast('Failed to cancel competition', 'error');
            }
        }
        
        async function deleteCompetition() {
            if (!confirm('DELETE this competition? This cannot be undone!')) return;
            if (!confirm('Are you absolutely sure?')) return;
            
            try {
                await CompetitionService.delete(competitionId);
                showToast('Competition deleted', 'success');
                setTimeout(() => window.location.href = 'browse.html', 1000);
            } catch (error) {
                showToast('Failed to delete competition', 'error');
            }
        }
        
        async function removePlayer(playerId) {
            if (!confirm('Remove this player?')) return;
            
            try {
                await CompetitionService.unregisterPlayer(competitionId, playerId);
                competition = await CompetitionService.getById(competitionId);
                renderPlayers();
                showToast('Player removed', 'success');
            } catch (error) {
                showToast('Failed to remove player', 'error');
            }
        }
        
        function copyShareLink() {
            const input = document.getElementById('share-link');
            input.select();
            document.execCommand('copy');
            showToast('Link copied!', 'success');
        }
        
        // ===== FORMS =====
        
        document.getElementById('add-player-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('add-player-name').value.trim();
            if (!name) return;
            
            try {
                const playerId = 'manual_' + Date.now();
                await CompetitionService.registerPlayer(competitionId, {
                    id: playerId,
                    name: name
                });
                
                competition = await CompetitionService.getById(competitionId);
                renderPlayers();
                renderManagement();
                document.getElementById('add-player-name').value = '';
                showToast('Player added', 'success');
            } catch (error) {
                showToast(error.message || 'Failed to add player', 'error');
            }
        });
        
        document.getElementById('settings-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            try {
                await CompetitionService.update(competitionId, {
                    name: document.getElementById('edit-name').value.trim(),
                    description: document.getElementById('edit-description').value.trim(),
                    eventDate: document.getElementById('edit-date').value,
                    eventTime: document.getElementById('edit-time').value,
                    location: document.getElementById('edit-location').value.trim()
                });
                
                competition = await CompetitionService.getById(competitionId);
                renderManagement();
                showToast('Settings saved!', 'success');
            } catch (error) {
                showToast('Failed to save settings', 'error');
            }
        });
        
        // ===== UTILITY =====
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text || '';
            return div.innerHTML;
        }
        
        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            const bgColor = type === 'error' ? 'bg-red-600' : type === 'success' ? 'bg-green-600' : 'bg-gray-800';
            toast.className = `${bgColor} text-white px-4 py-3 rounded-xl shadow-lg animate-fade-in-up`;
            toast.textContent = message;
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transition = 'opacity 0.3s';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        // Start
        init();
    </script>
</body>
</html>
