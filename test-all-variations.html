<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UberPadel - Complete Variation Test Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        .test-pass { background: #dcfce7; border-left: 4px solid #22c55e; }
        .test-fail { background: #fef2f2; border-left: 4px solid #ef4444; }
        .test-running { background: #fef9c3; border-left: 4px solid #eab308; }
        .test-pending { background: #f3f4f6; border-left: 4px solid #9ca3af; }
        .log-entry { font-family: monospace; font-size: 11px; padding: 2px 8px; }
        .category-header { position: sticky; top: 0; z-index: 10; }
    </style>
</head>
<body class="bg-gray-900 min-h-screen p-4">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="bg-gray-800 rounded-2xl p-6 mb-6 border border-gray-700">
            <div class="flex items-center justify-between mb-4">
                <div>
                    <h1 class="text-3xl font-bold text-white mb-1">üß™ Complete Variation Test Suite</h1>
                    <p class="text-gray-400">Tests every possible player/team count for all tournament formats</p>
                </div>
                <div class="text-right">
                    <div class="text-4xl font-bold text-white" id="total-count">0</div>
                    <div class="text-gray-400 text-sm">Total Tests</div>
                </div>
            </div>
            
            <div class="grid grid-cols-4 gap-4 mb-4">
                <div class="bg-gray-700 rounded-xl p-4 text-center">
                    <div class="text-2xl font-bold text-blue-400" id="americano-count">20</div>
                    <div class="text-gray-400 text-sm">Americano</div>
                    <div class="text-gray-500 text-xs">5-24 players</div>
                </div>
                <div class="bg-gray-700 rounded-xl p-4 text-center">
                    <div class="text-2xl font-bold text-teal-400" id="mexicano-count">18</div>
                    <div class="text-gray-400 text-sm">Mexicano</div>
                    <div class="text-gray-500 text-xs">Ind + Team modes</div>
                </div>
                <div class="bg-gray-700 rounded-xl p-4 text-center">
                    <div class="text-2xl font-bold text-purple-400" id="teamleague-count">8</div>
                    <div class="text-gray-400 text-sm">Team League</div>
                    <div class="text-gray-500 text-xs">4-24 teams</div>
                </div>
                <div class="bg-gray-700 rounded-xl p-4 text-center">
                    <div class="text-2xl font-bold text-orange-400" id="mix-count">3</div>
                    <div class="text-gray-400 text-sm">Mix Tournament</div>
                    <div class="text-gray-500 text-xs">20, 24, 28 players</div>
                </div>
            </div>
            
            <div class="flex gap-3">
                <button onclick="runAllVariationTests()" class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-xl font-semibold transition-colors flex items-center gap-2">
                    <span>‚ñ∂Ô∏è</span> Run All Tests
                </button>
                <button onclick="runQuickTest()" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-semibold transition-colors flex items-center gap-2">
                    <span>‚ö°</span> Quick Test (1 each)
                </button>
                <button onclick="cleanupAllTests()" class="px-6 py-3 bg-red-600 hover:bg-red-700 text-white rounded-xl font-semibold transition-colors flex items-center gap-2">
                    <span>üóëÔ∏è</span> Cleanup All
                </button>
                <button onclick="exportResults()" class="px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-xl font-semibold transition-colors flex items-center gap-2">
                    <span>üìã</span> Export Results
                </button>
            </div>
        </div>
        
        <!-- Progress -->
        <div class="bg-gray-800 rounded-2xl p-4 mb-6 border border-gray-700">
            <div class="flex items-center justify-between mb-2">
                <span class="text-gray-400">Progress</span>
                <span class="text-white font-mono" id="progress-text">0 / 0</span>
            </div>
            <div class="h-4 bg-gray-700 rounded-full overflow-hidden">
                <div id="progress-bar" class="h-full bg-gradient-to-r from-green-500 to-emerald-500 transition-all duration-300" style="width: 0%"></div>
            </div>
            <div class="flex justify-between mt-2 text-sm">
                <span class="text-green-400">‚úÖ <span id="passed-count">0</span> passed</span>
                <span class="text-red-400">‚ùå <span id="failed-count">0</span> failed</span>
                <span class="text-gray-400">‚è≥ <span id="pending-count">0</span> pending</span>
            </div>
        </div>
        
        <!-- Test Results Grid -->
        <div class="grid grid-cols-2 gap-6">
            <!-- Americano -->
            <div class="bg-gray-800 rounded-2xl border border-gray-700 overflow-hidden">
                <div class="category-header px-6 py-4 bg-blue-900/50 border-b border-gray-700">
                    <h2 class="text-xl font-bold text-blue-400 flex items-center gap-2">
                        üéæ Americano Format
                        <span class="text-sm font-normal text-gray-400">(5-24 players)</span>
                    </h2>
                </div>
                <div id="americano-results" class="p-4 space-y-1 max-h-96 overflow-y-auto"></div>
            </div>
            
            <!-- Mexicano -->
            <div class="bg-gray-800 rounded-2xl border border-gray-700 overflow-hidden">
                <div class="category-header px-6 py-4 bg-teal-900/50 border-b border-gray-700">
                    <h2 class="text-xl font-bold text-teal-400 flex items-center gap-2">
                        üåÆ Mexicano Format
                        <span class="text-sm font-normal text-gray-400">(Individual + Team)</span>
                    </h2>
                </div>
                <div id="mexicano-results" class="p-4 space-y-1 max-h-96 overflow-y-auto"></div>
            </div>
            
            <!-- Team League -->
            <div class="bg-gray-800 rounded-2xl border border-gray-700 overflow-hidden">
                <div class="category-header px-6 py-4 bg-purple-900/50 border-b border-gray-700">
                    <h2 class="text-xl font-bold text-purple-400 flex items-center gap-2">
                        üë• Team League Format
                        <span class="text-sm font-normal text-gray-400">(4-24 teams)</span>
                    </h2>
                </div>
                <div id="teamleague-results" class="p-4 space-y-1 max-h-96 overflow-y-auto"></div>
            </div>
            
            <!-- Mix Tournament -->
            <div class="bg-gray-800 rounded-2xl border border-gray-700 overflow-hidden">
                <div class="category-header px-6 py-4 bg-orange-900/50 border-b border-gray-700">
                    <h2 class="text-xl font-bold text-orange-400 flex items-center gap-2">
                        üèÜ Mix Tournament Format
                        <span class="text-sm font-normal text-gray-400">(20, 24, 28 players)</span>
                    </h2>
                </div>
                <div id="mix-results" class="p-4 space-y-1 max-h-96 overflow-y-auto"></div>
            </div>
        </div>
        
        <!-- Activity Log -->
        <div class="bg-gray-800 rounded-2xl border border-gray-700 mt-6 overflow-hidden">
            <div class="px-6 py-4 bg-gray-700/50 border-b border-gray-700 flex items-center justify-between">
                <h2 class="text-xl font-bold text-gray-300">üìã Activity Log</h2>
                <button onclick="document.getElementById('activity-log').innerHTML=''" class="text-gray-400 hover:text-white text-sm">Clear</button>
            </div>
            <div id="activity-log" class="p-4 max-h-48 overflow-y-auto font-mono text-xs space-y-1"></div>
        </div>
        
        <!-- Created Tournaments -->
        <div class="bg-gray-800 rounded-2xl border border-gray-700 mt-6 overflow-hidden">
            <div class="px-6 py-4 bg-gray-700/50 border-b border-gray-700 flex items-center justify-between">
                <h2 class="text-xl font-bold text-gray-300">üóÑÔ∏è Created Tournaments (<span id="tournament-count">0</span>)</h2>
                <div class="flex gap-2">
                    <button onclick="copyTournamentList()" class="px-3 py-1 bg-gray-600 hover:bg-gray-500 text-white rounded text-sm">Copy List</button>
                </div>
            </div>
            <div id="tournaments-list" class="p-4 max-h-64 overflow-y-auto">
                <p class="text-gray-500 text-sm">No tournaments created yet...</p>
            </div>
        </div>
    </div>

    <script>
    // ============================================
    // FIREBASE CONFIG
    // ============================================
    const firebaseConfig = {
        apiKey: "AIzaSyDYIlRS_me7sy7ptNmRrvPQCeXP2H-hHzU",
        authDomain: "stretford-padel-tournament.firebaseapp.com",
        databaseURL: "https://stretford-padel-tournament-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "stretford-padel-tournament",
        storageBucket: "stretford-padel-tournament.firebasestorage.app",
        messagingSenderId: "596263602058",
        appId: "1:596263602058:web:f69f7f8d00c60abbd0aa73"
    };
    
    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }
    const database = firebase.database();
    
    // ============================================
    // TEST CONFIGURATION - ALL VARIATIONS
    // ============================================
    const TEST_CONFIGS = {
        americano: {
            // 5-24 players (20 variations)
            playerCounts: [5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24],
            scoringModes: [
                { fixedPoints: true, totalPoints: 32 },
                { fixedPoints: false, totalPoints: 32 }
            ]
        },
        mexicano: {
            // Individual mode: 8, 12, 16, 20, 24, 28, 32, 36, 40 (multiples of 4)
            individual: [8, 12, 16, 20, 24, 28, 32, 36, 40],
            // Team mode: 4, 6, 8, 10, 12, 16, 20 teams
            team: [4, 6, 8, 10, 12, 16, 20],
            pointsOptions: [16, 21, 24, 32]
        },
        teamLeague: {
            // 4-24 teams
            teamCounts: [4, 6, 8, 10, 12, 14, 16, 20, 24],
            groupConfigs: {
                4: 1, 6: 1, 8: 2, 10: 2, 12: 3, 14: 2, 16: 4, 20: 4, 24: 4
            }
        },
        mixTournament: {
            // 20, 24, 28 players
            playerSizes: [20, 24, 28]
        }
    };
    
    // ============================================
    // STATE
    // ============================================
    let createdTournaments = [];
    let testResults = { passed: 0, failed: 0, total: 0, pending: 0 };
    let isRunning = false;
    
    // ============================================
    // UTILITIES
    // ============================================
    function generateId() {
        return 'T' + Math.random().toString(36).substring(2, 8).toUpperCase();
    }
    
    function generatePasscode() {
        return Math.random().toString(36).substring(2, 8).toUpperCase();
    }
    
    function log(message, type = 'info') {
        const colors = { info: 'text-gray-400', success: 'text-green-400', error: 'text-red-400', warn: 'text-yellow-400' };
        const el = document.getElementById('activity-log');
        const time = new Date().toLocaleTimeString();
        el.innerHTML += `<div class="log-entry ${colors[type]}">[${time}] ${message}</div>`;
        el.scrollTop = el.scrollHeight;
    }
    
    function updateProgress() {
        const total = testResults.total;
        const done = testResults.passed + testResults.failed;
        const percent = total > 0 ? Math.round((done / total) * 100) : 0;
        
        document.getElementById('progress-bar').style.width = `${percent}%`;
        document.getElementById('progress-text').textContent = `${done} / ${total}`;
        document.getElementById('passed-count').textContent = testResults.passed;
        document.getElementById('failed-count').textContent = testResults.failed;
        document.getElementById('pending-count').textContent = testResults.pending;
        document.getElementById('total-count').textContent = total;
        document.getElementById('tournament-count').textContent = createdTournaments.length;
    }
    
    function addTestResult(container, id, name, status, details = '') {
        const el = document.getElementById(container);
        const existing = document.querySelector(`[data-test-id="${id}"]`);
        
        const statusColors = {
            pass: 'test-pass',
            fail: 'test-fail',
            running: 'test-running',
            pending: 'test-pending'
        };
        const icons = { pass: '‚úÖ', fail: '‚ùå', running: '‚è≥', pending: '‚è∏Ô∏è' };
        
        const html = `
            <div data-test-id="${id}" class="p-2 rounded ${statusColors[status]} flex items-center justify-between">
                <span class="text-gray-800 text-sm">${icons[status]} ${name}</span>
                <span class="text-xs text-gray-600">${details}</span>
            </div>
        `;
        
        if (existing) {
            existing.outerHTML = html;
        } else {
            el.innerHTML += html;
        }
    }
    
    function addTournament(type, id, passcode, config) {
        createdTournaments.push({ type, id, passcode, config, createdAt: new Date().toISOString() });
        updateTournamentsList();
    }
    
    function updateTournamentsList() {
        const el = document.getElementById('tournaments-list');
        if (createdTournaments.length === 0) {
            el.innerHTML = '<p class="text-gray-500 text-sm">No tournaments created yet...</p>';
            return;
        }
        
        el.innerHTML = createdTournaments.map(t => `
            <div class="flex items-center justify-between p-2 bg-gray-700/50 rounded mb-1 text-sm">
                <span class="text-gray-300"><strong class="text-white">${t.type}</strong> - ${t.id}</span>
                <span class="text-gray-500 font-mono">${t.passcode}</span>
            </div>
        `).join('');
    }
    
    // ============================================
    // AMERICANO TESTS
    // ============================================
    async function testAmericano(playerCount) {
        const id = generateId();
        const passcode = generatePasscode();
        const testId = `americano-${playerCount}`;
        const testName = `${playerCount} Players`;
        const courts = Math.floor(playerCount / 4) || 1;
        
        addTestResult('americano-results', testId, testName, 'running', 'Creating...');
        
        try {
            const data = {
                meta: {
                    name: `Test Americano ${playerCount}P`,
                    createdAt: new Date().toISOString(),
                    accessMode: 'passcode',
                    isTest: true
                },
                organiserKey: passcode,
                playerCount: playerCount,
                courtCount: courts,
                playerNames: Array.from({length: playerCount}, (_, i) => `Player ${i + 1}`),
                courtNames: Array.from({length: courts}, (_, i) => `Court ${i + 1}`),
                fixedPoints: true,
                totalPoints: 32,
                scores: {},
                tournamentStarted: true
            };
            
            await database.ref(`americano-tournaments/${id}`).set(data);
            
            // Verify it was created
            const snapshot = await database.ref(`americano-tournaments/${id}/playerCount`).once('value');
            if (snapshot.val() === playerCount) {
                addTestResult('americano-results', testId, testName, 'pass', `${id} (${courts} courts)`);
                addTournament(`Americano ${playerCount}P`, id, passcode, { playerCount, courts });
                testResults.passed++;
                log(`‚úÖ Americano ${playerCount}P created: ${id}`, 'success');
                return true;
            } else {
                throw new Error('Verification failed');
            }
        } catch (e) {
            addTestResult('americano-results', testId, testName, 'fail', e.message);
            testResults.failed++;
            log(`‚ùå Americano ${playerCount}P failed: ${e.message}`, 'error');
            return false;
        } finally {
            testResults.pending--;
            updateProgress();
        }
    }
    
    // ============================================
    // MEXICANO TESTS
    // ============================================
    async function testMexicanoIndividual(playerCount) {
        const id = generateId();
        const passcode = generatePasscode();
        const testId = `mexicano-ind-${playerCount}`;
        const testName = `Individual ${playerCount}P`;
        const courts = Math.floor(playerCount / 4);
        
        addTestResult('mexicano-results', testId, testName, 'running', 'Creating...');
        
        try {
            const players = Array.from({length: playerCount}, (_, i) => ({
                id: `p${i+1}`,
                name: `Player ${i + 1}`
            }));
            
            const data = {
                meta: {
                    name: `Test Mexicano Ind ${playerCount}P`,
                    mode: 'individual',
                    pointsPerMatch: 32,
                    createdAt: new Date().toISOString(),
                    status: 'active',
                    isTest: true
                },
                organiserKey: passcode,
                players: players,
                teams: [],
                rounds: [],
                currentRound: 0,
                courtNames: Array.from({length: courts}, (_, i) => `Court ${i + 1}`)
            };
            
            await database.ref(`mexicano-tournaments/${id}`).set(data);
            
            const snapshot = await database.ref(`mexicano-tournaments/${id}/players`).once('value');
            const savedPlayers = snapshot.val();
            if (savedPlayers && savedPlayers.length === playerCount) {
                addTestResult('mexicano-results', testId, testName, 'pass', `${id} (${courts} courts)`);
                addTournament(`Mexicano Ind ${playerCount}P`, id, passcode, { mode: 'individual', playerCount });
                testResults.passed++;
                log(`‚úÖ Mexicano Individual ${playerCount}P created: ${id}`, 'success');
                return true;
            } else {
                throw new Error('Player count mismatch');
            }
        } catch (e) {
            addTestResult('mexicano-results', testId, testName, 'fail', e.message);
            testResults.failed++;
            log(`‚ùå Mexicano Ind ${playerCount}P failed: ${e.message}`, 'error');
            return false;
        } finally {
            testResults.pending--;
            updateProgress();
        }
    }
    
    async function testMexicanoTeam(teamCount) {
        const id = generateId();
        const passcode = generatePasscode();
        const testId = `mexicano-team-${teamCount}`;
        const testName = `Team ${teamCount}T`;
        const courts = Math.floor(teamCount / 4);
        
        addTestResult('mexicano-results', testId, testName, 'running', 'Creating...');
        
        try {
            const teams = Array.from({length: teamCount}, (_, i) => ({
                id: `t${i+1}`,
                teamName: `Team ${i + 1}`,
                player1: `Player ${i*2 + 1}`,
                player2: `Player ${i*2 + 2}`
            }));
            
            const data = {
                meta: {
                    name: `Test Mexicano Team ${teamCount}T`,
                    mode: 'team',
                    pointsPerMatch: 32,
                    createdAt: new Date().toISOString(),
                    status: 'active',
                    isTest: true
                },
                organiserKey: passcode,
                players: [],
                teams: teams,
                rounds: [],
                currentRound: 0,
                courtNames: Array.from({length: courts}, (_, i) => `Court ${i + 1}`)
            };
            
            await database.ref(`mexicano-tournaments/${id}`).set(data);
            
            const snapshot = await database.ref(`mexicano-tournaments/${id}/teams`).once('value');
            const savedTeams = snapshot.val();
            if (savedTeams && savedTeams.length === teamCount) {
                addTestResult('mexicano-results', testId, testName, 'pass', `${id} (${courts} courts)`);
                addTournament(`Mexicano Team ${teamCount}T`, id, passcode, { mode: 'team', teamCount });
                testResults.passed++;
                log(`‚úÖ Mexicano Team ${teamCount}T created: ${id}`, 'success');
                return true;
            } else {
                throw new Error('Team count mismatch');
            }
        } catch (e) {
            addTestResult('mexicano-results', testId, testName, 'fail', e.message);
            testResults.failed++;
            log(`‚ùå Mexicano Team ${teamCount}T failed: ${e.message}`, 'error');
            return false;
        } finally {
            testResults.pending--;
            updateProgress();
        }
    }
    
    // ============================================
    // TEAM LEAGUE TESTS
    // ============================================
    async function testTeamLeague(teamCount) {
        const id = generateId();
        const passcode = generatePasscode();
        const testId = `teamleague-${teamCount}`;
        const testName = `${teamCount} Teams`;
        const groupCount = TEST_CONFIGS.teamLeague.groupConfigs[teamCount] || 1;
        
        addTestResult('teamleague-results', testId, testName, 'running', 'Creating...');
        
        try {
            const teams = Array.from({length: teamCount}, (_, i) => ({
                id: `team_${i}`,
                name: `Team ${String.fromCharCode(65 + i)}`,
                player1: `Player ${i*2 + 1}`,
                player2: `Player ${i*2 + 2}`
            }));
            
            // Create groups
            const groups = {};
            const teamsPerGroup = Math.ceil(teamCount / groupCount);
            for (let g = 0; g < groupCount; g++) {
                const groupName = `Group ${String.fromCharCode(65 + g)}`;
                const startIdx = g * teamsPerGroup;
                const endIdx = Math.min(startIdx + teamsPerGroup, teamCount);
                groups[groupName] = teams.slice(startIdx, endIdx).map(t => t.id);
            }
            
            const data = {
                meta: {
                    name: `Test Team League ${teamCount}T`,
                    createdAt: new Date().toISOString(),
                    status: 'group_stage',
                    isTest: true
                },
                organiserKey: passcode,
                teams: teams,
                groups: groups,
                groupFixtures: {},
                groupScores: {},
                knockoutMatches: {},
                knockoutScores: {},
                courts: ['Court 1', 'Court 2'],
                pointsPerWin: 3,
                pointsPerDraw: 1,
                pointsPerLoss: 0
            };
            
            await database.ref(`team-league-tournaments/${id}`).set(data);
            
            const snapshot = await database.ref(`team-league-tournaments/${id}/teams`).once('value');
            const savedTeams = snapshot.val();
            if (savedTeams && savedTeams.length === teamCount) {
                addTestResult('teamleague-results', testId, testName, 'pass', `${id} (${groupCount} groups)`);
                addTournament(`Team League ${teamCount}T`, id, passcode, { teamCount, groupCount });
                testResults.passed++;
                log(`‚úÖ Team League ${teamCount}T created: ${id}`, 'success');
                return true;
            } else {
                throw new Error('Team count mismatch');
            }
        } catch (e) {
            addTestResult('teamleague-results', testId, testName, 'fail', e.message);
            testResults.failed++;
            log(`‚ùå Team League ${teamCount}T failed: ${e.message}`, 'error');
            return false;
        } finally {
            testResults.pending--;
            updateProgress();
        }
    }
    
    // ============================================
    // MIX TOURNAMENT TESTS
    // ============================================
    async function testMixTournament(playerSize) {
        const id = generateId();
        const passcode = generatePasscode();
        const testId = `mix-${playerSize}`;
        const testName = `${playerSize} Players`;
        
        addTestResult('mix-results', testId, testName, 'running', 'Creating...');
        
        try {
            const playerNames = Array.from({length: playerSize}, (_, i) => `Player ${i + 1}`);
            const skillRatings = {};
            for (let i = 1; i <= playerSize; i++) {
                skillRatings[i] = 2.5 + (Math.random() * 2);
            }
            
            const data = {
                meta: {
                    name: `Test Mix ${playerSize}P`,
                    createdAt: new Date().toISOString(),
                    playerSize: playerSize,
                    status: 'active',
                    isTest: true
                },
                organiserKey: passcode,
                playerNames: playerNames,
                skillRatings: skillRatings,
                scores: {},
                knockoutScores: {},
                fixtureMaxScore: 21,
                knockoutMaxScore: 21,
                showFairnessTabs: true
            };
            
            await database.ref(`tournaments/${id}`).set(data);
            
            const snapshot = await database.ref(`tournaments/${id}/playerNames`).once('value');
            const savedNames = snapshot.val();
            if (savedNames && savedNames.length === playerSize) {
                addTestResult('mix-results', testId, testName, 'pass', `${id}`);
                addTournament(`Mix ${playerSize}P`, id, passcode, { playerSize });
                testResults.passed++;
                log(`‚úÖ Mix Tournament ${playerSize}P created: ${id}`, 'success');
                return true;
            } else {
                throw new Error('Player count mismatch');
            }
        } catch (e) {
            addTestResult('mix-results', testId, testName, 'fail', e.message);
            testResults.failed++;
            log(`‚ùå Mix ${playerSize}P failed: ${e.message}`, 'error');
            return false;
        } finally {
            testResults.pending--;
            updateProgress();
        }
    }
    
    // ============================================
    // RUN ALL TESTS
    // ============================================
    async function runAllVariationTests() {
        if (isRunning) return;
        isRunning = true;
        
        // Reset
        testResults = { passed: 0, failed: 0, total: 0, pending: 0 };
        document.getElementById('americano-results').innerHTML = '';
        document.getElementById('mexicano-results').innerHTML = '';
        document.getElementById('teamleague-results').innerHTML = '';
        document.getElementById('mix-results').innerHTML = '';
        
        log('üöÄ Starting complete variation test suite...', 'info');
        
        // Calculate totals
        const americanoCount = TEST_CONFIGS.americano.playerCounts.length;
        const mexicanoIndCount = TEST_CONFIGS.mexicano.individual.length;
        const mexicanoTeamCount = TEST_CONFIGS.mexicano.team.length;
        const teamLeagueCount = TEST_CONFIGS.teamLeague.teamCounts.length;
        const mixCount = TEST_CONFIGS.mixTournament.playerSizes.length;
        
        testResults.total = americanoCount + mexicanoIndCount + mexicanoTeamCount + teamLeagueCount + mixCount;
        testResults.pending = testResults.total;
        updateProgress();
        
        // Initialize pending states
        TEST_CONFIGS.americano.playerCounts.forEach(pc => 
            addTestResult('americano-results', `americano-${pc}`, `${pc} Players`, 'pending', 'Waiting...'));
        TEST_CONFIGS.mexicano.individual.forEach(pc => 
            addTestResult('mexicano-results', `mexicano-ind-${pc}`, `Individual ${pc}P`, 'pending', 'Waiting...'));
        TEST_CONFIGS.mexicano.team.forEach(tc => 
            addTestResult('mexicano-results', `mexicano-team-${tc}`, `Team ${tc}T`, 'pending', 'Waiting...'));
        TEST_CONFIGS.teamLeague.teamCounts.forEach(tc => 
            addTestResult('teamleague-results', `teamleague-${tc}`, `${tc} Teams`, 'pending', 'Waiting...'));
        TEST_CONFIGS.mixTournament.playerSizes.forEach(ps => 
            addTestResult('mix-results', `mix-${ps}`, `${ps} Players`, 'pending', 'Waiting...'));
        
        // Run Americano tests (5-24 players)
        log('üìã Testing Americano format (5-24 players)...', 'info');
        for (const playerCount of TEST_CONFIGS.americano.playerCounts) {
            await testAmericano(playerCount);
            await new Promise(r => setTimeout(r, 100)); // Small delay between tests
        }
        
        // Run Mexicano Individual tests
        log('üìã Testing Mexicano Individual mode...', 'info');
        for (const playerCount of TEST_CONFIGS.mexicano.individual) {
            await testMexicanoIndividual(playerCount);
            await new Promise(r => setTimeout(r, 100));
        }
        
        // Run Mexicano Team tests
        log('üìã Testing Mexicano Team mode...', 'info');
        for (const teamCount of TEST_CONFIGS.mexicano.team) {
            await testMexicanoTeam(teamCount);
            await new Promise(r => setTimeout(r, 100));
        }
        
        // Run Team League tests
        log('üìã Testing Team League format...', 'info');
        for (const teamCount of TEST_CONFIGS.teamLeague.teamCounts) {
            await testTeamLeague(teamCount);
            await new Promise(r => setTimeout(r, 100));
        }
        
        // Run Mix Tournament tests
        log('üìã Testing Mix Tournament format...', 'info');
        for (const playerSize of TEST_CONFIGS.mixTournament.playerSizes) {
            await testMixTournament(playerSize);
            await new Promise(r => setTimeout(r, 100));
        }
        
        // Summary
        const passRate = Math.round((testResults.passed / testResults.total) * 100);
        log(`\nüèÅ Test suite complete: ${testResults.passed}/${testResults.total} passed (${passRate}%)`, 
            passRate === 100 ? 'success' : 'warn');
        
        isRunning = false;
    }
    
    // ============================================
    // QUICK TEST (1 of each)
    // ============================================
    async function runQuickTest() {
        if (isRunning) return;
        isRunning = true;
        
        testResults = { passed: 0, failed: 0, total: 4, pending: 4 };
        document.getElementById('americano-results').innerHTML = '';
        document.getElementById('mexicano-results').innerHTML = '';
        document.getElementById('teamleague-results').innerHTML = '';
        document.getElementById('mix-results').innerHTML = '';
        updateProgress();
        
        log('‚ö° Running quick test (1 of each format)...', 'info');
        
        await testAmericano(8);
        await testMexicanoIndividual(8);
        await testTeamLeague(8);
        await testMixTournament(24);
        
        log(`‚ö° Quick test complete: ${testResults.passed}/4 passed`, testResults.passed === 4 ? 'success' : 'warn');
        isRunning = false;
    }
    
    // ============================================
    // CLEANUP
    // ============================================
    async function cleanupAllTests() {
        if (createdTournaments.length === 0) {
            alert('No test tournaments to clean up.');
            return;
        }
        
        if (!confirm(`Delete ${createdTournaments.length} test tournaments?\n\nThis will remove all test data from Firebase.`)) {
            return;
        }
        
        log('üßπ Cleaning up test tournaments...', 'info');
        
        let deleted = 0;
        for (const t of createdTournaments) {
            try {
                let path;
                if (t.type.includes('Americano')) path = `americano-tournaments/${t.id}`;
                else if (t.type.includes('Mexicano')) path = `mexicano-tournaments/${t.id}`;
                else if (t.type.includes('Team League')) path = `team-league-tournaments/${t.id}`;
                else if (t.type.includes('Mix')) path = `tournaments/${t.id}`;
                
                if (path) {
                    await database.ref(path).remove();
                    deleted++;
                }
            } catch (e) {
                log(`Failed to delete ${t.id}: ${e.message}`, 'error');
            }
        }
        
        log(`üßπ Cleanup complete: ${deleted}/${createdTournaments.length} deleted`, 'success');
        createdTournaments = [];
        updateTournamentsList();
        document.getElementById('tournament-count').textContent = '0';
    }
    
    // ============================================
    // EXPORT
    // ============================================
    function exportResults() {
        const data = {
            timestamp: new Date().toISOString(),
            results: testResults,
            tournaments: createdTournaments
        };
        
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `uberpadel-test-results-${Date.now()}.json`;
        a.click();
        URL.revokeObjectURL(url);
        
        log('üìã Results exported to JSON file', 'success');
    }
    
    function copyTournamentList() {
        const text = createdTournaments.map(t => `${t.type}: ${t.id} (${t.passcode})`).join('\n');
        navigator.clipboard.writeText(text);
        log('üìã Tournament list copied to clipboard', 'success');
    }
    
    // Initialize counts
    document.getElementById('americano-count').textContent = TEST_CONFIGS.americano.playerCounts.length;
    document.getElementById('mexicano-count').textContent = TEST_CONFIGS.mexicano.individual.length + TEST_CONFIGS.mexicano.team.length;
    document.getElementById('teamleague-count').textContent = TEST_CONFIGS.teamLeague.teamCounts.length;
    document.getElementById('mix-count').textContent = TEST_CONFIGS.mixTournament.playerSizes.length;
    document.getElementById('total-count').textContent = 
        TEST_CONFIGS.americano.playerCounts.length + 
        TEST_CONFIGS.mexicano.individual.length + 
        TEST_CONFIGS.mexicano.team.length + 
        TEST_CONFIGS.teamLeague.teamCounts.length + 
        TEST_CONFIGS.mixTournament.playerSizes.length;
    </script>
</body>
</html>
